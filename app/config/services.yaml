parameters:
    faker.locale: 'en_US'

services:
    _defaults:
        autowire: true

    _instanceof:
        Smile\GdprDump\Converter\ConverterInterface:
            shared: false
            tags: ['converter'] # used by ConverterAliasPass to create aliases for data converters
        Smile\GdprDump\Phar\Minify\MinifierInterface:
            tags: ['compiler.minifier']
        Symfony\Component\Console\Command\Command:
            public: true # used by Kernel

    Smile\GdprDump\:
        resource: '../../src/'
        exclude:
            - '../../src/Kernel.php'
            - '../../src/Console/Application.php'

    Smile\GdprDump\Console\Command\CompileCommand:
        $defaultLocale: '%faker.locale%'

    Smile\GdprDump\Config\Loader\ConfigLoader:
        public: true # used by functional tests
        shared: false

    Smile\GdprDump\Config\EventListener\DefaultSettingsListener:
        tags:
            - { name: 'kernel.event_listener', priority: 100 }

    Smile\GdprDump\Config\EventListener\EnvVarListener:
        tags:
           - { name: 'kernel.event_listener', priority: 100 }

    Smile\GdprDump\Config\EventListener\VersionListener:
        tags:
            - { name: 'kernel.event_listener', method: 'onLoad' }
            - { name: 'kernel.event_listener', method: 'onParse' }
            - { name: 'kernel.event_listener', method: 'onMerge' }

    Smile\GdprDump\Config\EventListener\DatabaseUrlListener:
        tags: ['kernel.event_listener']

    Smile\GdprDump\Config\EventListener\DumpOutputListener:
        tags: ['kernel.event_listener']

    Smile\GdprDump\Converter\ConverterBuilder:
        shared: false

    Smile\GdprDump\Converter\ConditionBuilder:
        shared: false

    Smile\GdprDump\Dumper\MysqlDumper:
        public: true # used by functional tests
        shared: false

    Smile\GdprDump\Dumper\EventListener\FakerLocaleListener:
        tags:
            - { name: 'kernel.event_listener', priority: 100 } # must be triggered before data converter listener

    Smile\GdprDump\Dumper\EventListener\DataConverterListener:
        tags: ['kernel.event_listener']

    Smile\GdprDump\Dumper\EventListener\TableFilterListener:
        tags: ['kernel.event_listener']

    Smile\GdprDump\Faker\FakerService:
        public: true # used by functional tests
        arguments:
            $locale: '%faker.locale%'

    Smile\GdprDump\Phar\Compiler:
        arguments:
            - !tagged_iterator compiler.minifier
